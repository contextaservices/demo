/*!
 * contexta demo v0.0.1 (http://contexta.com)
 * Project description
 *
 * by kuus <kunderikuus@gmail.com> (http://kunderikuus.net/)
 * Copyright (C) kunderi kuus, Inc - All Rights Reserved 2016-2017
 */
"use strict";angular.module("demo",["ngAnimate","ui.bootstrap"]).config(["$interpolateProvider",function(e){e.startSymbol("<%{"),e.endSymbol("}%>")}]).controller("DemoCtrl",["$scope","$timeout","$animate","Player","Demo",function(e,t,a,n,i){function r(t,n){var r="seek"===n.type;r?o(n.seconds):(a.enabled(!0),e.demo.attrs.typeDelay=50,i.rawData[n.seconds]&&s(n.seconds),e.demo.data=i.data)}function o(t){a.enabled(!1),e.demo.attrs.typeDelay=0,i.data=angular.copy(i.dataModel);for(var n in i.rawData)parseInt(n,10)<=parseInt(t,10)&&s(n);e.demo.data=i.data}function s(e){var t=i.rawData[e];t.sentence&&(i.data.dialogue.push(t.sentence),u("scroll__dialogue",1)),t.sentiment&&(i.data.sentiment=i.a(i.data.sentiment,t.sentiment)),t.nps&&(i.data.nps=i.a(i.data.nps,t.nps)),t.tags&&(i.data.tags=i.b(i.data.tags,t.tags,e)),t.feedback&&(i.data.feedback=i.c(i.data.feedback,t.feedback),u("scroll__feedback",1))}function l(t){e.demo.attrs.typeDelay=0,n.seekToSeconds(Math.max(t-1,0))}function u(e,a){t(function(){var t=document.getElementById(e);t&&$(t).animate({scrollTop:t.scrollHeight},300)},a)}i.init(),e.demo={},e.demo.attrs=i.attrs,e.demo.attrs.skin=i.d(),e.demo.data=i.dataModel,e.demo.rawData={},e.demo.validData=!0,i.deferred.promise.then(function(){e.demo.rawData=i.rawData},function(){e.loadError=!0}),e.$watch("demo.rawData",function(e){i.rawData=e}),e.changeSkin=function(t){e.demo.skin=t},e.$on("Player.hasPlayed",function(){e.running=!0}),n.deferred.promise.then(function(){n.wavesurfer.on("pause",function(){e.demo.typeDelay=0})}),e.$on("moment",r),e.tagClick=l}]).service("Demo",["$q","$location","$http","$window","Player",function(e,t,a,n,i){this.deferred=e.defer(),this.attrs={skins:["neutral","coolblue","bolcom","dark"],skin:"",running:!1,typeDelay:50},this.dataModel={dialogue:[],sentiment:50,nps:50,tags:[],feedback:[]},this.rawData={},this.data={},this.init=function(){var e=this;e.data=angular.copy(e.dataModel),e.rawData=n.APPDATA_INDEX,e.deferred.resolve()},this.d=function(){var e=t.path();return e&&(e=e.replace("/skin=","")),this.attrs.skins.indexOf(e)!==-1?e.replace("/skin=",""):this.attrs.skins[0]},this.a=function(e,t){var a=t.substr(0,1),n=parseInt(t.substr(1,t.length),10);return"+"===a?e+n:"-"===a?e-n:void 0},this.c=function(e,t){for(var a=!0,n=0;n<e.length;n++){var i=e[n];if(i.id===t.id){a=!1;try{e[n].title=t.title,e[n].content=t.content}catch(r){}}}return a&&e.push(angular.copy(t)),e},this.b=function(e,t,a){return t.add?e.concat(this.e(t.add,a)):t.remove?this.f(e,this.e(t.remove,a)):void 0},this.e=function(e,t){return angular.forEach(e,function(e){e.seconds=Math.floor(t)}),e},this.f=function(e,t){for(var a=[],n=[],i=0;i<e.length;i++)a[e[i]]=!0;for(var r=0;r<t.length;r++)a[t[r]]?delete a[t[r]]:a[t[r]]=!0;for(var o in a)n.push(o);return n}}]).directive("objectEdit",function(){return{restrict:"A",require:"^ngModel",link:function(e,t,a,n){function i(e){return JSON.parse(e)}function r(e){return JSON.stringify(e,null,4)}e.$watch(function(){return n.$modelValue},function(e){n.$modelValue=""},!0),n.$parsers.unshift(i),n.$formatters.push(r)}}}).directive("emptiness",function(){return{restrict:"E",transclude:!0,replace:!1,link:function(){},template:'<div class="emptiness__wrappest text-muted"><div class="emptiness__wrapper" ><div class="emptiness__wrap" ng-transclude></div></div></div>'}}),angular.module("demo").directive("typewriter",["$interval","$timeout",function(e,t){return{restrict:"AE",scope:{content:"=",typeDelay:"="},link:function(e,a,n){function i(){m+=f,v.nodeValue=s.substr(0,m),0===m||m===s.length?c?m=0:f*=-1:(t(i,o()),h.innerHTML="")}function r(){return f===-1?u:d}function o(){return f===-1?e.typeDelay:p?Math.round(l-p+p*Math.random()):e.typeDelay}var s,l=e.typeDelay||150,u=+n.eraseDelay||3e3,d=+n.initialDelay||750,c=n.newLine||!1,p=n.humanize?2*l/100*+n.humanize:0,f=1,m=0,v=document.createTextNode("");if(0===m&&(s=e.content),0===e.typeDelay)v.nodeValue=s,a[0].appendChild(v);else{var h=document.createElement("i");h.innerHTML="...",a[0].appendChild(v),a[0].appendChild(h),t(i,r())}}}}]),angular.module("demo").service("Player",["$window","$q",function(e,t){this.deferred=t.defer(),this.playing=!1,this.hasPlayed=!1,this.wavesurer=null,this.init=function(t,a){var n=this;n.wavesurfer=angular.copy(e.WaveSurfer),n.wavesurfer.init(t),n.wavesurfer.load(a),n.wavesurfer.on("ready",function(){n.deferred.resolve("ready")}),n.wavesurfer.on("play",function(){n.playing=!n.playing})},this.seekToSeconds=function(e){this.wavesurfer.seekTo(e/this.duration)},this.emitTime=function(e,t,a){a.$emit("moment",{type:e,seconds:t})},this.playPause=function(e){var t=this;t.deferred.promise.then(function(){t.wavesurfer.playPause(),e&&(t.hasPlayed=!0,e.$emit("Player.hasPlayed"))})}}]).filter("hms",function(){return function(e){var t=parseInt(e,10),a=Math.floor(t/3600),n=Math.floor((t-3600*a)/60),i=t-3600*a-60*n;a<10&&(a="0"+a),n<10&&(n="0"+n),i<10&&(i="0"+i);var r=n+":"+i;return r}}).directive("player",["Player",function(e){var t=1;return{restrict:"AE",scope:{url:"@",options:"="},template:'<div ng-class="{\'is-playing\': playing, \'is-loading\': loading}"><div ng-show="!duration" class="player__loading" title="Loading ..."><svg class="loader-container" width="35px" height="35px" viewBox="0 0 52 52"><circle class="path" cx="26px" cy="26px" r="20px" fill="none" stroke-width="2px" /></svg></div><div class="player__waveform" id="{{::uniqueId}}"></div><div class="player__controls"><div class="player__controls-inner"><span role="button" class="player__playpause" ng-click="playpause()"><span class="player__playpause-play" title="Play">&#9658;</span><span class="player__playpause-pause" title="Pause">II</span></span><span role="button" class="player__stop" ng-click="stop()" title="Stop">&#9726;</span><span class="player__timer"><time class="player__time">{{moment | hms}}</time> / <time class="player__duration">{{duration | hms}}</time></span></div></div></div>',link:function(a,n){a.uniqueId="waveform_"+t++,a.playing=!1,a.loading=!0,a.duration=0,a.moment=0;var i={container:n.children().children()[1],waveColor:"#C1D2E5",progressColor:"#fff",cursorWidth:0,height:90};e.init(angular.extend(i,a.options),a.url),a.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},a.playpause=function(){e.playPause()},a.stop=function(){e.deferred.promise.then(function(){try{e.wavesurfer.seekTo(0),e.wavesurfer.stop()}catch(t){}a.playing=!1})},e.wavesurfer.on("play",function(){a.playing=!a.playing}),e.wavesurfer.on("pause",function(){a.playing=!a.playing}),e.wavesurfer.on("ready",function(){a.loading=!1,a.duration=e.duration=""+Math.floor(e.wavesurfer.getDuration()),a.moment=""+Math.floor(e.wavesurfer.getCurrentTime()),a.safeApply()}),e.wavesurfer.on("audioprocess",function(t){a.moment!==Math.floor(t)&&(a.moment=Math.floor(t),a.safeApply(),e.emitTime("playing",a.moment,a))}),e.wavesurfer.on("seek",function(){a.moment=Math.floor(e.wavesurfer.getCurrentTime()),a.safeApply(),e.emitTime("seek",a.moment,a)}),e.wavesurfer.on("finish",function(){a.playing=!1})}}}]),angular.module("demo").directive("indicatorBar",function(){return{restrict:"AE",scope:{value:"="},template:'<div class="indicator__text" style="background: rgb({{color}})"><span class="indicator__text-text"><span count-to="{{countTo}}" value="{{value}}" duration="1"></span>%</span></div><div class="indicator__bar"><div class="indicator__pipes"><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i></div><div class="indicator__gradient"><div class="indicator__cursor" style="left: {{value}}%"></div></div></div>',link:function(e){function t(e){if(0===e)return n[0][1].join();e=Math.max(e,1);for(var t=[],i=!1,r=0;r<n.length;r++){var o=n[r];e<=o[0]&&!i&&(t=t=[r-1,r],i=!0)}var s=n[t[0]][1],l=n[t[1]][1],u=n[t[0]][0],d=n[t[1]][0]-u,c=e-u,p=c/d,f=a(l,s,p);return f.join()}function a(e,t,a){var n=a,i=2*n-1,r=(i/1+1)/2,o=1-r,s=[Math.max(Math.min(Math.round(e[0]*r+t[0]*o),255),0),Math.max(Math.min(Math.round(e[1]*r+t[1]*o),255),0),Math.max(Math.min(Math.round(e[2]*r+t[2]*o),255),0)];return s}var n=[[1,[233,60,56]],[50,[251,199,17]],[100,[139,197,64]]];e.$watch("value",function(a){var n=t(a);e.countTo=a,n&&(e.color=n)})}}}),angular.module("demo").directive("countTo",["$timeout",function(e){return{replace:!1,scope:!0,link:function(t,a,n){var i,r,o,s,l,u,d,c=a[0],p=function(){r=30,l=0,t.timoutId=null,u=parseInt(n.countTo)||0,t.value=parseInt(n.value,10)||0,o=1e3*parseFloat(n.duration)||0,s=Math.ceil(o/r),d=(u-t.value)/s,i=t.value},f=function(){t.timoutId=e(function(){i+=d,l++,l>=s?(e.cancel(t.timoutId),i=u,c.textContent=u):(c.textContent=Math.round(i),f())},r)},m=function(){t.timoutId&&e.cancel(t.timoutId),p(),f()};return n.$observe("countTo",function(e){e&&m()}),n.$observe("value",function(){m()}),!0}}}]);